[Unit]
Description=WebLogic Managed Servers for eppm_domain on prmapp01
After=network.target weblogic-adminserver.service
Requires=weblogic-adminserver.service
BindsTo=weblogic-adminserver.service

[Service]
Type=oneshot
RemainAfterExit=yes
User=oracle
Group=oinstall
WorkingDirectory=/u01/app/weblogic/user_projects/domains/eppm_domain

# Set Oracle/WebLogic environment
Environment="JAVA_HOME=/u01/app/java"
Environment="MW_HOME=/u01/app/weblogic"
Environment="WL_HOME=/u01/app/weblogic/wlserver"
Environment="DOMAIN_HOME=/u01/app/weblogic/user_projects/domains/eppm_domain"

# Wait for Admin Server to be fully ready (up to 5 minutes)
ExecStartPre=/bin/bash -c 'for i in {1..60}; do curl -s http://prmapp01:7001 >/dev/null 2>&1 && break || sleep 5; done'

# Start managed servers on prmapp01 (4 servers)
ExecStart=/bin/bash -c 'source /u01/app/weblogic/user_projects/domains/eppm_domain/bin/setDomainEnv.sh && /u01/app/weblogic/oracle_common/common/bin/wlst.sh /home/oracle/start-managed-servers.py'

# Stop managed servers on prmapp01
ExecStop=/bin/bash -c 'source /u01/app/weblogic/user_projects/domains/eppm_domain/bin/setDomainEnv.sh && /u01/app/weblogic/oracle_common/common/bin/wlst.sh /home/oracle/stop-managed-servers.py'

# Timeouts (starting 4 servers)
TimeoutStartSec=600
TimeoutStopSec=300

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=managedservers-prmapp01

[Install]
WantedBy=multi-user.target
